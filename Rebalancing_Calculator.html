<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SOXL-VXX 리밸런싱 계산기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00b894 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 모바일 반응형 */
        @media screen and (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 0.9em;
            }
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .calculator {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }
        
        /* 모바일 탭 */
        @media screen and (max-width: 768px) {
            .tab {
                padding: 12px 8px;
                font-size: 0.85em;
            }
        }
        
        @media screen and (max-width: 480px) {
            .tab {
                padding: 10px 5px;
                font-size: 0.75em;
            }
        }
        
        .tab:hover {
            background: #e9ecef;
            color: #333;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 모바일 탭 컨텐츠 */
        @media screen and (max-width: 768px) {
            .tab-content {
                padding: 20px 15px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .tab-content {
                padding: 15px 10px;
            }
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* 모바일 입력 그룹 */
        @media screen and (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        .input-field {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .input-field label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .input-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .stock-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
        }
        
        .soxl-section {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }
        
        .vxx-section {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }
        
        .stock-section h4 {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .stock-section .input-field {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .stock-section .input-field input {
            background: white;
            border: 1px solid #ccc;
        }
        
        .stock-section .input-field input:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.3s;
            margin: 5px;
        }
        
        /* 모바일 버튼 */
        @media screen and (max-width: 768px) {
            .btn {
                padding: 10px 20px;
                font-size: 0.9em;
                margin: 3px;
                width: 100%;
                max-width: 200px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .btn {
                padding: 8px 16px;
                font-size: 0.85em;
            }
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.secondary:hover {
            background: #5a6268;
        }
        
        .result-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .result-card .label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .result-card .value {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .portfolio-summary {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        
        .summary-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px 40px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .summary-card .label {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .summary-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }
        
        .portfolio-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 모바일 포트폴리오 상세 */
        @media screen and (max-width: 768px) {
            .portfolio-details {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        .stock-detail-card {
            padding: 20px;
            border-radius: 10px;
            border: 2px solid transparent;
        }
        
        .soxl-detail {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .vxx-detail {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* 모바일 상세 그리드 */
        @media screen and (max-width: 480px) {
            .detail-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .detail-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.2em;
            font-weight: bold;
            color: white;
        }
        
        .adjustment-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .adjustment-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .adjustment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ffeaa7;
        }
        
        .adjustment-item:last-child {
            border-bottom: none;
        }
        
        .adjustment-item .action {
            font-weight: 600;
        }
        
        .adjustment-item .amount {
            font-weight: bold;
            color: #856404;
        }
        
        .history-section {
            margin-top: 30px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9em;
        }
        
        /* 모바일 테이블 */
        @media screen and (max-width: 768px) {
            .history-table {
                font-size: 0.75em;
            }
            
            .history-table th,
            .history-table td {
                padding: 8px 4px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .history-table {
                font-size: 0.7em;
            }
            
            .history-table th,
            .history-table td {
                padding: 6px 3px;
            }
        }
        
        .history-table th,
        .history-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
        }
        
        .history-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .history-table th:last-child,
        .history-table td:last-child {
            border-right: none;
        }
        
        .history-table tr:hover {
            background: #f8f9fa;
        }
        
        .history-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .history-table tr:nth-child(even):hover {
            background-color: #e9ecef;
        }
        
        .performance-chart {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* 모바일 차트 */
        @media screen and (max-width: 768px) {
            .performance-chart {
                padding: 15px;
            }
            
            #performanceChart {
                width: 100% !important;
                height: 300px !important;
            }
        }
        
        @media screen and (max-width: 480px) {
            .performance-chart {
                padding: 10px;
            }
            
            #performanceChart {
                height: 250px !important;
            }
        }
        
        .target-ratios {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .target-ratios h3 {
            color: #2d5a2d;
            margin-bottom: 15px;
        }
        
        .ratio-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }
        
        /* 모바일 비율 컨트롤 */
        @media screen and (max-width: 768px) {
            .ratio-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        .ratio-control-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6c3;
        }
        
        .ratio-control-item label {
            display: block;
            font-weight: 600;
            color: #2d5a2d;
            margin-bottom: 10px;
        }
        
        .ratio-slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .ratio-slider {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #28a745 0%, #20c997 50%, #28a745 100%);
            outline: none;
            -webkit-appearance: none;
        }
        
        .ratio-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #28a745;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .ratio-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #28a745;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .ratio-display-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #28a745;
            min-width: 50px;
            text-align: center;
        }
        
        .ratio-summary {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #c3e6c3;
        }
        
        /* 모바일 비율 요약 */
        @media screen and (max-width: 768px) {
            .ratio-summary {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        .ratio-summary-item {
            text-align: center;
            padding: 10px 20px;
            background: white;
            border-radius: 5px;
            border: 1px solid #c3e6c3;
            flex: 1;
        }
        
        .ratio-summary-item.total {
            background: #2d5a2d;
            color: white;
            border: none;
        }
        
        .ratio-summary-item strong {
            font-size: 1.2em;
            color: #2d5a2d;
        }
        
        .ratio-summary-item.total strong {
            color: white;
        }
        
        .month-selector {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .month-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            margin: 0 10px;
        }
        
        /* 모바일 선택기 */
        @media screen and (max-width: 768px) {
            .month-selector {
                padding: 12px;
            }
            
            .month-selector select {
                padding: 10px 8px;
                font-size: 0.9em;
                margin: 5px;
                width: 100%;
                max-width: 150px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .month-selector select {
                font-size: 0.85em;
                padding: 8px 6px;
            }
        }
        
        .clear-btn {
            background: #dc3545;
        }
        
        .clear-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SOXL-VXX 리밸런싱 계산기</h1>
            <p>목표 비율 75% SOXL, 25% VXX 달성을 위한 투자 조정 계산기</p>
        </div>

        <div class="calculator">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('calculator')">📊 계산기</button>
                <button class="tab" onclick="switchTab('history')">📈 투자 히스토리</button>
                <button class="tab" onclick="switchTab('performance')">📊 성과 분석</button>
            </div>

            <!-- 계산기 탭 -->
            <div id="calculator" class="tab-content active">
                <div class="target-ratios">
                    <h3>🎯 목표 포트폴리오 비율 설정</h3>
                    <div class="ratio-controls">
                        <div class="ratio-control-item">
                            <label for="soxlRatio">SOXL 비율:</label>
                            <div class="ratio-slider-container">
                                <input type="range" id="soxlRatio" min="0" max="100" value="75" step="5" 
                                       oninput="updateRatioDisplay()" class="ratio-slider">
                                <span id="soxlRatioDisplay" class="ratio-display-value">75%</span>
                            </div>
                        </div>
                        <div class="ratio-control-item">
                            <label for="vxxRatio">VXX 비율:</label>
                            <div class="ratio-slider-container">
                                <input type="range" id="vxxRatio" min="0" max="100" value="25" step="5" 
                                       oninput="updateRatioDisplay()" class="ratio-slider">
                                <span id="vxxRatioDisplay" class="ratio-display-value">25%</span>
                            </div>
                        </div>
                    </div>
                    <div class="ratio-summary">
                        <div class="ratio-summary-item">
                            <span>SOXL: <strong id="summarySoxlRatio">75%</strong></span>
                        </div>
                        <div class="ratio-summary-item">
                            <span>VXX: <strong id="summaryVxxRatio">25%</strong></span>
                        </div>
                        <div class="ratio-summary-item total">
                            <span>총합: <strong id="totalRatio">100%</strong></span>
                        </div>
                    </div>
                </div>

                <div class="month-selector">
                    <label for="yearSelect">📅 투자 기간 선택:</label>
                    <select id="yearSelect" onchange="updateYearMonth()">
                        <option value="2024">2024년</option>
                        <option value="2025" selected>2025년</option>
                        <option value="2026">2026년</option>
                        <option value="2027">2027년</option>
                    </select>
                    <select id="monthSelect" onchange="updateYearMonth()">
                        <option value="1">1월</option>
                        <option value="2">2월</option>
                        <option value="3">3월</option>
                        <option value="4">4월</option>
                        <option value="5">5월</option>
                        <option value="6">6월</option>
                        <option value="7">7월</option>
                        <option value="8">8월</option>
                        <option value="9">9월</option>
                        <option value="10">10월</option>
                        <option value="11">11월</option>
                        <option value="12">12월</option>
                    </select>
                    <button class="btn clear-btn" onclick="clearCurrentMonth()">현재 기간 초기화</button>
                    <button class="btn secondary" onclick="saveCurrentData()">💾 수정 저장</button>
                </div>

                <div class="input-section">
                    <h3>📊 현재 포트폴리오 입력</h3>
                    
                    <!-- SOXL 섹션 -->
                    <div class="stock-section soxl-section">
                        <h4 style="color: #28a745; margin-bottom: 15px; font-size: 1.2em;">📈 SOXL (<span id="soxlTargetLabel">75%</span> 목표)</h4>
                        <div class="input-group">
                            <div class="input-field">
                                <label for="soxlPrice">현재 가격 ($)</label>
                                <input type="number" id="soxlPrice" step="0.01" placeholder="예: 27.95">
                            </div>
                            <div class="input-field">
                                <label for="soxlShares">보유 주식 수</label>
                                <input type="number" id="soxlShares" step="0.01" placeholder="예: 268.37">
                            </div>
                        </div>
                    </div>
                    
                    <!-- VXX 섹션 -->
                    <div class="stock-section vxx-section">
                        <h4 style="color: #dc3545; margin-bottom: 15px; font-size: 1.2em;">📉 VXX (<span id="vxxTargetLabel">25%</span> 목표)</h4>
                        <div class="input-group">
                            <div class="input-field">
                                <label for="vxxPrice">현재 가격 ($)</label>
                                <input type="number" id="vxxPrice" step="0.01" placeholder="예: 45.10">
                            </div>
                            <div class="input-field">
                                <label for="vxxShares">보유 주식 수</label>
                                <input type="number" id="vxxShares" step="0.01" placeholder="예: 55.43">
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="calculateRebalancing()">🔄 리밸런싱 계산</button>
                    </div>
                </div>

                <div id="results" style="display: none;">
                    <div class="result-section">
                        <h3>📈 현재 포트폴리오 현황</h3>
                        
                        <!-- 총 포트폴리오 가치 -->
                        <div class="portfolio-summary">
                            <div class="summary-card">
                                <div class="label">총 포트폴리오 가치</div>
                                <div class="value" id="totalValue">$0</div>
                            </div>
                        </div>
                        
                        <!-- 종목별 상세 정보 -->
                        <div class="portfolio-details">
                            <!-- SOXL 섹션 -->
                            <div class="stock-detail-card soxl-detail">
                                <h4 style="color: white; margin-bottom: 15px; font-size: 1.1em;">📈 SOXL</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">현재 가격</div>
                                        <div class="detail-value" id="soxlPriceDisplay">$0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">보유 주식 수</div>
                                        <div class="detail-value" id="soxlSharesDisplay">0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">총 가치</div>
                                        <div class="detail-value" id="soxlValue">$0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">현재 비율</div>
                                        <div class="detail-value" id="currentSoxlRatio">0%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- VXX 섹션 -->
                            <div class="stock-detail-card vxx-detail">
                                <h4 style="color: white; margin-bottom: 15px; font-size: 1.1em;">📉 VXX</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">현재 가격</div>
                                        <div class="detail-value" id="vxxPriceDisplay">$0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">보유 주식 수</div>
                                        <div class="detail-value" id="vxxSharesDisplay">0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">총 가치</div>
                                        <div class="detail-value" id="vxxValue">$0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">현재 비율</div>
                                        <div class="detail-value" id="currentVxxRatio">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="adjustment-section">
                        <h3>⚖️ 리밸런싱 조정 방안</h3>
                        <div id="adjustmentDetails"></div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="saveRebalancing()">💾 리밸런싱 저장</button>
                        <button class="btn secondary" onclick="resetCalculator()">🔄 초기화</button>
                    </div>
                </div>
            </div>

            <!-- 투자 히스토리 탭 -->
            <div id="history" class="tab-content">
                <div class="history-section">
                    <h3>📈 월별 투자 히스토리</h3>
                    <table class="history-table" id="historyTable">
                        <thead>
                            <tr>
                                <th rowspan="2">년도</th>
                                <th rowspan="2">월</th>
                                <th colspan="2" style="text-align: center; background-color: #28a745; color: white;">SOXL</th>
                                <th colspan="2" style="text-align: center; background-color: #dc3545; color: white;">VXX</th>
                                <th rowspan="2">총 가치</th>
                                <th rowspan="2">SOXL 비율</th>
                                <th rowspan="2">VXX 비율</th>
                                <th rowspan="2">월간 수익률</th>
                            </tr>
                            <tr>
                                <th style="background-color: #d4edda;">가격 ($)</th>
                                <th style="background-color: #d4edda;">주식 수</th>
                                <th style="background-color: #f8d7da;">가격 ($)</th>
                                <th style="background-color: #f8d7da;">주식 수</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 성과 분석 탭 -->
            <div id="performance" class="tab-content">
                <div class="performance-chart">
                    <h3>📊 누적 수익률 분석</h3>
                    <canvas id="performanceChart" width="800" height="400"></canvas>
                </div>
                
                <div class="result-grid" style="margin-top: 30px;">
                    <div class="result-card">
                        <div class="label">총 투자 기간</div>
                        <div class="value" id="totalPeriod">0개월</div>
                    </div>
                    <div class="result-card">
                        <div class="label">총 수익률</div>
                        <div class="value" id="totalReturn">0%</div>
                    </div>
                    <div class="result-card">
                        <div class="label">연간 수익률</div>
                        <div class="value" id="annualReturn">0%</div>
                    </div>
                    <div class="result-card">
                        <div class="label">최대 낙폭</div>
                        <div class="value" id="maxDrawdown">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 전역 변수
        let investmentHistory = [];
        let currentYear = 2025;
        let currentMonth = 1;
        let performanceChart = null;
        let targetSoxlRatio = 75;
        let targetVxxRatio = 25;

        // 년도/월별 데이터 저장소
        const monthlyData = {};

        function updateRatioDisplay() {
            targetSoxlRatio = parseInt(document.getElementById('soxlRatio').value);
            targetVxxRatio = parseInt(document.getElementById('vxxRatio').value);
            
            document.getElementById('soxlRatioDisplay').textContent = targetSoxlRatio + '%';
            document.getElementById('vxxRatioDisplay').textContent = targetVxxRatio + '%';
            document.getElementById('summarySoxlRatio').textContent = targetSoxlRatio + '%';
            document.getElementById('summaryVxxRatio').textContent = targetVxxRatio + '%';
            document.getElementById('totalRatio').textContent = (targetSoxlRatio + targetVxxRatio) + '%';
            
            // 입력 섹션의 목표 비율 라벨 업데이트
            document.getElementById('soxlTargetLabel').textContent = targetSoxlRatio + '%';
            document.getElementById('vxxTargetLabel').textContent = targetVxxRatio + '%';
            
            // 총합이 100%가 아니면 경고 표시
            const total = targetSoxlRatio + targetVxxRatio;
            const totalElement = document.getElementById('totalRatio');
            if (total !== 100) {
                totalElement.style.color = '#dc3545';
                totalElement.parentElement.style.background = '#f8d7da';
            } else {
                totalElement.style.color = 'white';
                totalElement.parentElement.style.background = '#2d5a2d';
            }
        }

        function switchTab(tabName) {
            // 모든 탭과 컨텐츠 비활성화
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 선택된 탭과 컨텐츠 활성화
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // 성과 분석 탭이 활성화되면 차트 업데이트
            if (tabName === 'performance') {
                updatePerformanceChart();
            }
        }

        function updateYearMonth() {
            currentYear = parseInt(document.getElementById('yearSelect').value);
            currentMonth = parseInt(document.getElementById('monthSelect').value);
            loadMonthData();
        }

        function loadMonthData() {
            const dataKey = `${currentYear}_${currentMonth}`;
            if (monthlyData[dataKey]) {
                const data = monthlyData[dataKey];
                document.getElementById('soxlPrice').value = data.soxlPrice || '';
                document.getElementById('soxlShares').value = data.soxlShares || '';
                document.getElementById('vxxPrice').value = data.vxxPrice || '';
                document.getElementById('vxxShares').value = data.vxxShares || '';
            } else {
                // 새 기간이면 초기화
                document.getElementById('soxlPrice').value = '';
                document.getElementById('soxlShares').value = '';
                document.getElementById('vxxPrice').value = '';
                document.getElementById('vxxShares').value = '';
            }
            // 결과 섹션 숨기기
            document.getElementById('results').style.display = 'none';
        }

        function saveMonthData() {
            const dataKey = `${currentYear}_${currentMonth}`;
            monthlyData[dataKey] = {
                year: currentYear,
                month: currentMonth,
                soxlPrice: parseFloat(document.getElementById('soxlPrice').value) || 0,
                soxlShares: parseFloat(document.getElementById('soxlShares').value) || 0,
                vxxPrice: parseFloat(document.getElementById('vxxPrice').value) || 0,
                vxxShares: parseFloat(document.getElementById('vxxShares').value) || 0,
                savedAt: new Date().toISOString()
            };
        }

        function saveCurrentData() {
            // 현재 입력된 데이터를 저장
            saveMonthData();
            alert(`${currentYear}년 ${currentMonth}월 데이터가 저장되었습니다!`);
        }

        function clearCurrentMonth() {
            const dataKey = `${currentYear}_${currentMonth}`;
            delete monthlyData[dataKey];
            document.getElementById('soxlPrice').value = '';
            document.getElementById('soxlShares').value = '';
            document.getElementById('vxxPrice').value = '';
            document.getElementById('vxxShares').value = '';
            document.getElementById('results').style.display = 'none';
            alert(`${currentYear}년 ${currentMonth}월 데이터가 삭제되었습니다.`);
        }

        function calculateRebalancing() {
            const soxlPrice = parseFloat(document.getElementById('soxlPrice').value) || 0;
            const soxlShares = parseFloat(document.getElementById('soxlShares').value) || 0;
            const vxxPrice = parseFloat(document.getElementById('vxxPrice').value) || 0;
            const vxxShares = parseFloat(document.getElementById('vxxShares').value) || 0;

            if (soxlPrice === 0 || vxxPrice === 0) {
                alert('모든 가격을 입력해주세요.');
                return;
            }

            // 현재 포트폴리오 가치 계산
            const soxlValue = soxlPrice * soxlShares;
            const vxxValue = vxxPrice * vxxShares;
            const totalValue = soxlValue + vxxValue;

            if (totalValue === 0) {
                alert('주식 수를 입력해주세요.');
                return;
            }

            // 현재 비율 계산
            const currentSoxlRatio = (soxlValue / totalValue) * 100;
            const currentVxxRatio = (vxxValue / totalValue) * 100;

            // 목표 비율 (사용자 설정값 사용)
            const targetSoxlRatioValue = targetSoxlRatio / 100;
            const targetVxxRatioValue = targetVxxRatio / 100;

            // 목표 가치 계산
            const targetSoxlValue = totalValue * targetSoxlRatioValue;
            const targetVxxValue = totalValue * targetVxxRatioValue;

            // 목표 주식 수 계산
            const targetSoxlShares = targetSoxlValue / soxlPrice;
            const targetVxxShares = targetVxxValue / vxxPrice;

            // 조정 필요량 계산
            const soxlAdjustment = targetSoxlShares - soxlShares;
            const vxxAdjustment = targetVxxShares - vxxShares;

            // 결과 표시
            document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // SOXL 정보
            document.getElementById('soxlPriceDisplay').textContent = `$${soxlPrice.toFixed(2)}`;
            document.getElementById('soxlSharesDisplay').textContent = soxlShares.toFixed(2);
            document.getElementById('soxlValue').textContent = `$${soxlValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('currentSoxlRatio').textContent = `${currentSoxlRatio.toFixed(2)}%`;
            
            // VXX 정보
            document.getElementById('vxxPriceDisplay').textContent = `$${vxxPrice.toFixed(2)}`;
            document.getElementById('vxxSharesDisplay').textContent = vxxShares.toFixed(2);
            document.getElementById('vxxValue').textContent = `$${vxxValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('currentVxxRatio').textContent = `${currentVxxRatio.toFixed(2)}%`;

            // 조정 방안 표시
            const adjustmentDetails = document.getElementById('adjustmentDetails');
            adjustmentDetails.innerHTML = `
                <div class="adjustment-item">
                    <span class="action">SOXL 조정: ${soxlAdjustment >= 0 ? '매수' : '매도'}</span>
                    <span class="amount">${Math.abs(soxlAdjustment).toFixed(2)}주 ($${Math.abs(soxlAdjustment * soxlPrice).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})})</span>
                </div>
                <div class="adjustment-item">
                    <span class="action">VXX 조정: ${vxxAdjustment >= 0 ? '매수' : '매도'}</span>
                    <span class="amount">${Math.abs(vxxAdjustment).toFixed(2)}주 ($${Math.abs(vxxAdjustment * vxxPrice).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})})</span>
                </div>
                <div class="adjustment-item">
                    <span class="action">순 자금 흐름:</span>
                    <span class="amount">$${(soxlAdjustment * soxlPrice + vxxAdjustment * vxxPrice).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                </div>
            `;

            document.getElementById('results').style.display = 'block';
        }

        function saveRebalancing() {
            const soxlPrice = parseFloat(document.getElementById('soxlPrice').value);
            const soxlShares = parseFloat(document.getElementById('soxlShares').value);
            const vxxPrice = parseFloat(document.getElementById('vxxPrice').value);
            const vxxShares = parseFloat(document.getElementById('vxxShares').value);

            // 현재 월 데이터 저장
            saveMonthData();

            // 리밸런싱 후 포트폴리오 계산
            const soxlValue = soxlPrice * soxlShares;
            const vxxValue = vxxPrice * vxxShares;
            const totalValue = soxlValue + vxxValue;

            // 목표 비율로 조정된 포트폴리오 (사용자 설정값 사용)
            const targetSoxlRatioValue = targetSoxlRatio / 100;
            const targetVxxRatioValue = targetVxxRatio / 100;
            const targetSoxlValue = totalValue * targetSoxlRatioValue;
            const targetVxxValue = totalValue * targetVxxRatioValue;
            const targetSoxlShares = targetSoxlValue / soxlPrice;
            const targetVxxShares = targetVxxValue / vxxPrice;

            // 히스토리에 추가
            const historyEntry = {
                year: currentYear,
                month: currentMonth,
                soxlPrice: soxlPrice,
                soxlShares: targetSoxlShares,
                vxxPrice: vxxPrice,
                vxxShares: targetVxxShares,
                totalValue: totalValue,
                soxlRatio: targetSoxlRatio,
                vxxRatio: targetVxxRatio,
                monthlyReturn: calculateMonthlyReturn()
            };

            investmentHistory.push(historyEntry);
            updateHistoryTable();
            updatePerformanceMetrics();

            alert(`${currentYear}년 ${currentMonth}월 리밸런싱이 저장되었습니다!`);
        }

        function calculateMonthlyReturn() {
            if (investmentHistory.length === 0) return 0;
            
            const currentValue = parseFloat(document.getElementById('totalValue').textContent.replace(/[$,]/g, ''));
            const lastEntry = investmentHistory[investmentHistory.length - 1];
            const lastValue = lastEntry.totalValue;
            
            return ((currentValue - lastValue) / lastValue) * 100;
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            investmentHistory.forEach(entry => {
                const row = tbody.insertRow();
                
                // 년도
                row.insertCell(0).textContent = `${entry.year}년`;
                row.cells[0].style.fontWeight = 'bold';
                row.cells[0].style.textAlign = 'center';
                row.cells[0].style.backgroundColor = '#e3f2fd';
                
                // 월
                row.insertCell(1).textContent = `${entry.month}월`;
                row.cells[1].style.fontWeight = 'bold';
                row.cells[1].style.textAlign = 'center';
                
                // SOXL 가격
                const soxlPriceCell = row.insertCell(2);
                soxlPriceCell.textContent = `$${entry.soxlPrice.toFixed(2)}`;
                soxlPriceCell.style.backgroundColor = '#d4edda';
                soxlPriceCell.style.textAlign = 'right';
                soxlPriceCell.style.fontWeight = '600';
                
                // SOXL 주식 수
                const soxlSharesCell = row.insertCell(3);
                soxlSharesCell.textContent = entry.soxlShares.toFixed(2);
                soxlSharesCell.style.backgroundColor = '#d4edda';
                soxlSharesCell.style.textAlign = 'right';
                
                // VXX 가격
                const vxxPriceCell = row.insertCell(4);
                vxxPriceCell.textContent = `$${entry.vxxPrice.toFixed(2)}`;
                vxxPriceCell.style.backgroundColor = '#f8d7da';
                vxxPriceCell.style.textAlign = 'right';
                vxxPriceCell.style.fontWeight = '600';
                
                // VXX 주식 수
                const vxxSharesCell = row.insertCell(5);
                vxxSharesCell.textContent = entry.vxxShares.toFixed(2);
                vxxSharesCell.style.backgroundColor = '#f8d7da';
                vxxSharesCell.style.textAlign = 'right';
                
                // 총 가치
                const totalValueCell = row.insertCell(6);
                totalValueCell.textContent = `$${entry.totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                totalValueCell.style.textAlign = 'right';
                totalValueCell.style.fontWeight = 'bold';
                totalValueCell.style.backgroundColor = '#e3f2fd';
                
                // SOXL 비율
                const soxlRatioCell = row.insertCell(7);
                soxlRatioCell.textContent = `${entry.soxlRatio}%`;
                soxlRatioCell.style.textAlign = 'center';
                soxlRatioCell.style.fontWeight = '600';
                soxlRatioCell.style.color = '#28a745';
                
                // VXX 비율
                const vxxRatioCell = row.insertCell(8);
                vxxRatioCell.textContent = `${entry.vxxRatio}%`;
                vxxRatioCell.style.textAlign = 'center';
                vxxRatioCell.style.fontWeight = '600';
                vxxRatioCell.style.color = '#dc3545';
                
                // 월간 수익률
                const monthlyReturnCell = row.insertCell(9);
                const returnValue = entry.monthlyReturn;
                monthlyReturnCell.textContent = `${returnValue.toFixed(2)}%`;
                monthlyReturnCell.style.textAlign = 'right';
                monthlyReturnCell.style.fontWeight = '600';
                
                // 수익률에 따른 색상 설정
                if (returnValue > 0) {
                    monthlyReturnCell.style.color = '#28a745';
                } else if (returnValue < 0) {
                    monthlyReturnCell.style.color = '#dc3545';
                } else {
                    monthlyReturnCell.style.color = '#6c757d';
                }
            });
        }

        function updatePerformanceMetrics() {
            if (investmentHistory.length === 0) return;

            const firstEntry = investmentHistory[0];
            const lastEntry = investmentHistory[investmentHistory.length - 1];
            
            const totalPeriod = investmentHistory.length;
            const totalReturn = ((lastEntry.totalValue - firstEntry.totalValue) / firstEntry.totalValue) * 100;
            const annualReturn = (Math.pow(lastEntry.totalValue / firstEntry.totalValue, 12 / totalPeriod) - 1) * 100;
            
            // 최대 낙폭 계산
            let maxValue = firstEntry.totalValue;
            let maxDrawdown = 0;
            
            investmentHistory.forEach(entry => {
                if (entry.totalValue > maxValue) {
                    maxValue = entry.totalValue;
                }
                const drawdown = ((entry.totalValue - maxValue) / maxValue) * 100;
                if (drawdown < maxDrawdown) {
                    maxDrawdown = drawdown;
                }
            });

            document.getElementById('totalPeriod').textContent = `${totalPeriod}개월`;
            document.getElementById('totalReturn').textContent = `${totalReturn.toFixed(2)}%`;
            document.getElementById('annualReturn').textContent = `${annualReturn.toFixed(2)}%`;
            document.getElementById('maxDrawdown').textContent = `${maxDrawdown.toFixed(2)}%`;
        }

        function updatePerformanceChart() {
            if (investmentHistory.length === 0) return;

            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }

            const months = investmentHistory.map(entry => `${entry.year}년 ${entry.month}월`);
            const values = investmentHistory.map(entry => entry.totalValue);
            const returns = investmentHistory.map((entry, index) => {
                if (index === 0) return 0;
                return ((entry.totalValue - investmentHistory[index - 1].totalValue) / investmentHistory[index - 1].totalValue) * 100;
            });

            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '포트폴리오 가치 ($)',
                            data: values,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: '월간 수익률 (%)',
                            data: returns,
                            borderColor: '#00b894',
                            backgroundColor: 'rgba(0, 184, 148, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '포트폴리오 성과 추이'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '포트폴리오 가치 ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '월간 수익률 (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function resetCalculator() {
            document.getElementById('soxlPrice').value = '';
            document.getElementById('soxlShares').value = '';
            document.getElementById('vxxPrice').value = '';
            document.getElementById('vxxShares').value = '';
            document.getElementById('results').style.display = 'none';
        }

        // 초기화
        window.onload = function() {
            loadMonthData();
        };
    </script>
</body>
</html>
